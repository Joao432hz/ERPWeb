{% extends "ui/base.html" %}
{% block title %}Compras · Actualizar proveedor #{{ supplier.id }} | ERPWeb{% endblock %}

{% block content %}
<div class="d-flex align-items-start justify-content-between gap-3 flex-wrap">
  <div>
    <h2 class="h4 mb-1">Compras · Actualizar proveedor #{{ supplier.id }}</h2>
    <p class="text-muted mb-0">Al guardar, se actualiza el mismo registro (mismo ID).</p>
  </div>
  <div>
    <a class="btn btn-outline-secondary" href="{% url 'ui:purchases_supplier_detail' supplier.id %}">Volver</a>
  </div>
</div>

<form method="post" enctype="multipart/form-data" class="mt-3">
  {% csrf_token %}

  {% if form.non_field_errors %}
    <div class="alert alert-danger">{{ form.non_field_errors }}</div>
  {% endif %}

  <div class="card mb-3">
    <div class="card-body">
      <h3 class="h6 mb-3">Identificación y datos generales</h3>
      <div class="row g-3">
        <div class="col-12 col-lg-6">
          <label class="form-label">Nombre legal / razón social</label>
          {{ form.name }}
          {% if form.name.errors %}<div class="text-danger small mt-1">{{ form.name.errors }}</div>{% endif %}
        </div>
        <div class="col-12 col-lg-6">
          <label class="form-label">Nombre comercial / corto</label>
          {{ form.trade_name }}
          {% if form.trade_name.errors %}<div class="text-danger small mt-1">{{ form.trade_name.errors }}</div>{% endif %}
        </div>

        <div class="col-12 col-lg-4">
          <label class="form-label">Tipo de proveedor</label>
          {{ form.supplier_type }}
          {% if form.supplier_type.errors %}<div class="text-danger small mt-1">{{ form.supplier_type.errors }}</div>{% endif %}
        </div>
        <div class="col-12 col-lg-4">
          <label class="form-label">Condición frente al IVA</label>
          {{ form.vat_condition }}
          {% if form.vat_condition.errors %}<div class="text-danger small mt-1">{{ form.vat_condition.errors }}</div>{% endif %}
        </div>
        <div class="col-12 col-lg-4">
          <label class="form-label">CUIT / NIF / Tax ID</label>
          {{ form.tax_id }}
          {% if form.tax_id.errors %}<div class="text-danger small mt-1">{{ form.tax_id.errors }}</div>{% endif %}
        </div>

        <div class="col-12 col-lg-4">
          <label class="form-label">Tipo de documento</label>
          {{ form.document_type }}
          {% if form.document_type.errors %}<div class="text-danger small mt-1">{{ form.document_type.errors }}</div>{% endif %}
        </div>

        <div class="col-12 col-lg-4">
          <label class="form-label">Estado del proveedor</label>
          {{ form.status }}
          {% if form.status.errors %}<div class="text-danger small mt-1">{{ form.status.errors }}</div>{% endif %}
        </div>
      </div>
    </div>
  </div>

  <div class="card mb-3">
    <div class="card-body">
      <h3 class="h6 mb-3">Domicilios y ubicación</h3>
      <div class="row g-3">
        <div class="col-12 col-lg-6">
          <label class="form-label">Dirección fiscal</label>
          {{ form.fiscal_address }}
          {% if form.fiscal_address.errors %}<div class="text-danger small mt-1">{{ form.fiscal_address.errors }}</div>{% endif %}
        </div>
        <div class="col-12 col-lg-3">
          <label class="form-label">Provincia / Estado</label>
          {{ form.province }}
          {% if form.province.errors %}<div class="text-danger small mt-1">{{ form.province.errors }}</div>{% endif %}
        </div>
        <div class="col-12 col-lg-3">
          <label class="form-label">Código postal</label>
          {{ form.postal_code }}
          {% if form.postal_code.errors %}<div class="text-danger small mt-1">{{ form.postal_code.errors }}</div>{% endif %}
        </div>
        <div class="col-12 col-lg-4">
          <label class="form-label">País</label>
          {{ form.country }}
          {% if form.country.errors %}<div class="text-danger small mt-1">{{ form.country.errors }}</div>{% endif %}
        </div>
      </div>
    </div>
  </div>

  <div class="card mb-3">
    <div class="card-body">
      <h3 class="h6 mb-3">Contacto</h3>
      <div class="row g-3">
        <div class="col-12 col-lg-4">
          <label class="form-label">Teléfono principal</label>
          {{ form.phone }}
          {% if form.phone.errors %}<div class="text-danger small mt-1">{{ form.phone.errors }}</div>{% endif %}
        </div>
        <div class="col-12 col-lg-4">
          <label class="form-label">Teléfono secundario</label>
          {{ form.phone_secondary }}
          {% if form.phone_secondary.errors %}<div class="text-danger small mt-1">{{ form.phone_secondary.errors }}</div>{% endif %}
        </div>
        <div class="col-12 col-lg-4">
          <label class="form-label">Fax / Web</label>
          {{ form.fax_or_web }}
          {% if form.fax_or_web.errors %}<div class="text-danger small mt-1">{{ form.fax_or_web.errors }}</div>{% endif %}
        </div>

        <div class="col-12 col-lg-6">
          <label class="form-label">Email principal</label>
          {{ form.email }}
          {% if form.email.errors %}<div class="text-danger small mt-1">{{ form.email.errors }}</div>{% endif %}
        </div>
        <div class="col-12 col-lg-6">
          <label class="form-label">Email compras / cobranzas</label>
          {{ form.email_ap }}
          {% if form.email_ap.errors %}<div class="text-danger small mt-1">{{ form.email_ap.errors }}</div>{% endif %}
        </div>

        <div class="col-12 col-lg-6">
          <label class="form-label">Contacto principal (nombre)</label>
          {{ form.contact_name }}
          {% if form.contact_name.errors %}<div class="text-danger small mt-1">{{ form.contact_name.errors }}</div>{% endif %}
        </div>
        <div class="col-12 col-lg-6">
          <label class="form-label">Cargo de contacto</label>
          {{ form.contact_role }}
          {% if form.contact_role.errors %}<div class="text-danger small mt-1">{{ form.contact_role.errors }}</div>{% endif %}
        </div>
      </div>
    </div>
  </div>

  <div class="card mb-3">
    <div class="card-body">
      <h3 class="h6 mb-3">Condiciones comerciales</h3>
      <div class="row g-3">
        <div class="col-12 col-lg-6">
          <div class="fw-semibold mb-2">{{ form.payment_terms.label }}</div>
          {{ form.payment_terms }}
          {% if form.payment_terms.errors %}<div class="text-danger small mt-1">{{ form.payment_terms.errors }}</div>{% endif %}
        </div>
        <div class="col-12 col-lg-6">
          <div class="fw-semibold mb-2">{{ form.standard_payment_terms.label }}</div>
          {{ form.standard_payment_terms }}
          {% if form.standard_payment_terms.errors %}<div class="text-danger small mt-1">{{ form.standard_payment_terms.errors }}</div>{% endif %}
        </div>

        <div class="col-12 col-lg-4">
          <label class="form-label">Frecuencia actualización lista (días)</label>
          {{ form.price_list_update_days }}
          {% if form.price_list_update_days.errors %}<div class="text-danger small mt-1">{{ form.price_list_update_days.errors }}</div>{% endif %}
        </div>
        <div class="col-12 col-lg-4">
          <label class="form-label">Moneda de transacción</label>
          {{ form.transaction_currency }}
          {% if form.transaction_currency.errors %}<div class="text-danger small mt-1">{{ form.transaction_currency.errors }}</div>{% endif %}
        </div>
        <div class="col-12 col-lg-4">
          <label class="form-label">Cuenta corriente acreedora activa</label>
          {{ form.account_reference }}
          {% if form.account_reference.errors %}<div class="text-danger small mt-1">{{ form.account_reference.errors }}</div>{% endif %}
        </div>

        <div class="col-12 col-lg-6">
          <label class="form-label">Clasificación / sector</label>
          {{ form.classification }}
          {% if form.classification.errors %}<div class="text-danger small mt-1">{{ form.classification.errors }}</div>{% endif %}
        </div>
        <div class="col-12 col-lg-6">
          <label class="form-label">Categoría productos del proveedor</label>
          {{ form.product_category }}
          {% if form.product_category.errors %}<div class="text-danger small mt-1">{{ form.product_category.errors }}</div>{% endif %}
        </div>
      </div>
    </div>
  </div>

  <div class="card mb-3">
    <div class="card-body">
      <h3 class="h6 mb-3">Datos bancarios</h3>
      <div class="row g-3">
        <div class="col-12 col-lg-4">
          <label class="form-label">Banco</label>
          {{ form.bank_name }}
          {% if form.bank_name.errors %}<div class="text-danger small mt-1">{{ form.bank_name.errors }}</div>{% endif %}
        </div>
        <div class="col-12 col-lg-4">
          <label class="form-label">Sucursal / CBU / IBAN</label>
          {{ form.bank_account_ref }}
          {% if form.bank_account_ref.errors %}<div class="text-danger small mt-1">{{ form.bank_account_ref.errors }}</div>{% endif %}
        </div>
        <div class="col-12 col-lg-4">
          <label class="form-label">Tipo de cuenta</label>
          {{ form.bank_account_type }}
          {% if form.bank_account_type.errors %}<div class="text-danger small mt-1">{{ form.bank_account_type.errors }}</div>{% endif %}
        </div>

        <div class="col-12 col-lg-6">
          <label class="form-label">Titular</label>
          {{ form.bank_account_holder }}
          {% if form.bank_account_holder.errors %}<div class="text-danger small mt-1">{{ form.bank_account_holder.errors }}</div>{% endif %}
        </div>
        <div class="col-12 col-lg-6">
          <label class="form-label">Moneda de cuenta</label>
          {{ form.bank_account_currency }}
          {% if form.bank_account_currency.errors %}<div class="text-danger small mt-1">{{ form.bank_account_currency.errors }}</div>{% endif %}
        </div>
      </div>
    </div>
  </div>

  <div class="card mb-3">
    <div class="card-body">
      <h3 class="h6 mb-3">Gestión tributaria y cumplimiento</h3>
      <div class="row g-3">
        <div class="col-12 col-lg-4">
          <label class="form-label">Condición tributaria</label>
          {{ form.tax_condition }}
          {% if form.tax_condition.errors %}<div class="text-danger small mt-1">{{ form.tax_condition.errors }}</div>{% endif %}
        </div>
        <div class="col-12 col-lg-4">
          <label class="form-label">Categoría retención IVA/Ganancias</label>
          {{ form.retention_category }}
          {% if form.retention_category.errors %}<div class="text-danger small mt-1">{{ form.retention_category.errors }}</div>{% endif %}
        </div>
        <div class="col-12 col-lg-4">
          <label class="form-label">Códigos de retenciones aplicables</label>
          {{ form.retention_codes }}
          {% if form.retention_codes.errors %}<div class="text-danger small mt-1">{{ form.retention_codes.errors }}</div>{% endif %}
        </div>
      </div>
    </div>
  </div>

  <div class="card mb-3">
    <div class="card-body">
      <h3 class="h6 mb-3">Otros datos</h3>
      <div class="row g-3">
        <div class="col-12">
          <label class="form-label">Notas internas / observaciones</label>
          {{ form.internal_notes }}
          {% if form.internal_notes.errors %}<div class="text-danger small mt-1">{{ form.internal_notes.errors }}</div>{% endif %}
        </div>

        <div class="col-12">
          <label class="form-label">{{ form.documents.label }}</label>
          {{ form.documents }}
          {% if form.documents.errors %}<div class="text-danger small mt-1">{{ form.documents.errors }}</div>{% endif %}
          <div class="small text-muted mt-1">Tipos: PDF/DOC/DOCX/JPG/BMP/PNG</div>
        </div>

        <div class="col-12">
          <label class="form-label">{{ form.extra_fields_text.label }}</label>
          {{ form.extra_fields_text }}
          {% if form.extra_fields_text.errors %}<div class="text-danger small mt-1">{{ form.extra_fields_text.errors }}</div>{% endif %}
          <div class="small text-muted mt-1">MVP: se guarda como JSON key/value.</div>
        </div>
      </div>
    </div>
  </div>

  <div class="d-flex gap-2">
    <button class="btn btn-primary">Actualizar proveedor</button>
    <a class="btn btn-outline-secondary" href="{% url 'ui:purchases_supplier_detail' supplier.id %}">Cancelar</a>
  </div>
</form>
{% endblock %}
